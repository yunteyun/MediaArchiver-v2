# 開発日記 (2026-02-22)

## 今日の概要
- サムネイル保存管理の整理を継続
- 書庫サムネイル / 書庫プレビューフレームの軽量化と保存先統一を進めた
- 右サイドバー / Lightbox での書庫プレビュー重複生成を削減
- `v1.1.3d5` リリースビルドを作成

## 実装・調整した内容
- 書庫サムネイルを優先 WebP 保存に変更（失敗時は元形式フォールバック）
- 書庫プレビューフレームも優先 WebP 保存に変更（失敗時は元形式フォールバック）
- 書庫プレビューフレームの最終保存先を `archive-preview` 配下へ統一
- `image / video / archive / previewFrame` の WebP 品質値を内部定数に分離
- 書庫プレビューを固定キャッシュ化（右サイドバー4枚 / Lightbox12枚で再利用）

## 品質・容量の検証（書庫プレビューフレーム）
- 解像度は `384px` を維持して比較
- `previewFrame` 品質を段階的に検証（73 / 68 / 60 / 45 / 30 / 40）
- 結果:
  - `30`: Lightboxでもノイズ感あり（下げすぎ）
  - `45`: 実用的だが拡大時に輪郭ぼやけが見える
  - `40`: 表示品質と容量のバランスが良好
- 最終候補:
  - `previewFrame = 40`
  - 書庫プレビューフレーム縮小サイズ `384px`

## 動作確認で分かったこと
- 書庫プレビューフレームは当初、右サイドバーとLightboxで別々に生成されていた
- 固定キャッシュ化後、`archive-preview` 配下で再利用されることを確認

## ドキュメント・運用
- `AGENTS.md` を新規追加
  - Windows + PowerShell 向け UTF-8 明示読み書きルール
  - `apply_patch` 優先ルール
  - 大規模置換前の差分確認ルール

## ビルド
- `1.1.3d5` に更新してリリースビルド成功
- 出力: `release/MediaArchiver v2-1.1.3-d5-win.zip`
- `package.json` の BOM によるビルド失敗が一度発生し、BOMなしUTF-8で修正

## コミット
- `c004` 書庫サムネイル WebP化
- `c005` WebP品質値の内部定数分離
- `c006` 書庫プレビューフレーム WebP化
- `c007` 書庫プレビューフレーム保存先を `archive-preview` 配下へ統一
- `c008` 書庫プレビューキャッシュ再利用 + 品質最終化（`previewFrame=40`）
- `c009` `AGENTS.md` 追加（文字化け対策ルール）

## 次回の候補
- `v1.1.3d5` の実機確認結果を `docs/user/アプリ使用メモ.md` に反映
- `CHANGELOG.md` / `ROADMAP.md` の文字化け表示対策（編集運用の安定化）
- サムネイル保存管理 Step 3 の残タスク整理

