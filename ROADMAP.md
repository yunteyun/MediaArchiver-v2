# Roadmap

MediaArchiver v2 の開発ロードマップです。
各 Phase の詳細な変更内容は [CHANGELOG.md](CHANGELOG.md) を参照してください。

---

## ✅ 完了済み Phase 一覧

| Phase | 名称 | 主な内容 | 完了時期 |
|-------|------|----------|----------|
| 0 | 再構築準備 | v1 問題分析、方針決定 | 2026-01 |
| 1 | プロジェクト基盤構築 | Vite + Electron + TS、Zustand、SQLite、IPC | 2026-01 |
| 2 | コア機能実装 | スキャン、ファイル操作、UI 連携、サムネイル生成 | 2026-01 |
| 3 | UI 機能拡張 | サイドバー、ソート、LightBox、コンテキストメニュー | 2026-01 |
| 4 | アーカイブ対応 | 書庫ファイル処理、書庫内プレビュー | 2026-01 |
| 5 | 機能拡張 | タグ管理、フィルタリング、検索、設定画面 | 2026-01 |
| 6 | プロファイル | DB 分割方式、ホバープレビュー | 2026-02 |
| 7 | ブラッシュアップ | キーボードショートカット、パフォーマンス最適化 | 2026-02 |
| 8 | データ整合性強化 | 自動削除、トランザクション、ログシステム | 2026-02 |
| 9 | コア機能拡張 | 音声対応、重複検出、全ファイルビュー、メモ | 2026-02 |
| 10 | DB 基盤強化 | マイグレーションシステム | 2026-02 |
| 11 | 統計・ログ | 円グラフ、棒グラフ、アクティビティログ | 2026-02 |
| 12 | UI/UX 改善 | トースト、カスタムプロトコル、タグ拡張、削除改善 他 | 2026-02 |
| 13 | FileCard 基礎設計 | `isAnimated`、レイアウト刷新、デザイントークン | 2026-02 |
| 14 | 表示モードシステム | Compact/Standard 切替、タグポップオーバー | 2026-02 |
| 15 | バッジ修正 & UI 改善 | アニメーションバッジ、タグ視認性、ファイルサイズ修正 | 2026-02 |
| 16 | FileCard インタラクション修正 | クリック挙動改善、複数選択修復 | 2026-02 |
| 17 | アクセストラッキング | アクセス回数カウント、直近アクセス、ソート機能 | 2026-02 |
| 18-A | 外部アプリ起動カウント | 起動回数追跡、DB保存、FileCard表示 | 2026-02 |
| 18-B | 外部アプリUX強化 | デフォルトアプリ設定、フォールバック、トースト通知 | 2026-02 |
| 18-C | ファイル操作機能 | ファイル移動、クロスドライブ対応 | 2026-02 |
| **v1.0.0** | **リリース準備** | **electron-builder、ビルド成功** | **2026-02** |
| 19.5 | Critical Bug Fixes | EventEmitter メモリリーク、複数選択削除/移動、孤立サムネイル誤検出 他 | 2026-02 |
| 20-A | Lightbox UI再設計 | 2カラム固定レイアウト、コンポーネント分離、パフォーマンス最適化 | 2026-02 |
| 20-B | 動画キーボード操作 | Space（再生/停止）、←→（シーク）、↑↓（音量）、日本語入力対応 | 2026-02 |
| 21 | グループ表示改善 | 相対時間区分追加（今日、昨日、今週、先週、2週間前）、パフォーマンス最適化 | 2026-02 |
| 22-C | フォルダツリーナビゲーション機能 | ドライブ/親フォルダ選択、ファイル移動ダイアログ、循環移動防止 | 2026-02 |
| 23 | 右サイドパネル | 選択ファイルの詳細情報常時表示（プレビュー・基本情報・タグ）、トグルボタン | 2026-02 |
| 24 | サムネイル軽量化 | WebP変換（静止画 q:82、動画 q:75、フレーム 256px×6枚 q:70）、一括再生成、容量レポート | 2026-02 |
| 25 | 保存場所カスタマイズ | AppData/インストールフォルダ/任意パス、原子的移行、thumbnail_path 一括更新 | 2026-02 |
| **v1.1.0** | **リリース** | **ZIP 形式、Phase 19.5〜25 含む** | **2026-02** |
| **26 (v1.1.2)** | **バグ修正・UX改善** | **書庫プレビューグリッド・音声書庫バッジ・バージョン表記・動画サムネイル修正** | **2026-02** |

---

## 🚧 進行中 (In Progress)

### Phase 26: タグ・評価システム刷新 🏷️⭐
**目的**: タグ管理UIの刷新と評価軸の物理的分離を実現する
**参考**: [タグ構造の刷新に関するメモ.md](タグ構造の刷新に関するメモ.md)
**方針**: 既存タグベース評価（cat_rating）は触らず、新規ファイルのみ評価軸を使用

- [x] DB基盤（`tag_categories` / `tag_definitions.category_id`）— Phase 1 で実装済み
- [ ] **26-A**: タグ管理画面を左右ペイン構造に刷新
- [ ] **26-B1**: 評価軸 DB マイグレーション + Service
- [ ] **26-B2**: 評価軸 IPC + preload + 型定義
- [ ] **26-B3**: 評価軸 Zustand Store + 管理UI
- [ ] **26-C1**: StarRatingInput + RightPanel 評価セクション
- [ ] **26-C2**: Lightbox 評価セクション + 統計画面更新
- [ ] **26-D1**: 検索クエリビルダー（バックエンド）
- [ ] **26-D2**: 詳細検索UI（フロントエンド）

---

## 📋 予定 (Planned)

---

### 追加表示モード（Phase 14 拡張）🎨
**目的**: 異なるコンテンツタイプに最適化された表示モード
**前提**: Phase 14 MVP の動作確認とユーザーフィードバック

- [ ] 漫画モード — 2:3 縦長サムネイル、イラスト閲覧最適化
- [ ] 動画モード — 16:9 横長サムネイル、再生時間強調
- [ ] WhiteBrowser 風モード — 横長レイアウト、情報密度高
  - 参考: [file_card_表示設計に関する将来要望まとめ.md](file_card_表示設計に関する将来要望まとめ.md)

---

### Phase 12 残タスク ⏸️
- [ ] 12-12: サムネイルアスペクト比対応 **保留**
  - 固定高さ維持が必要（TanStack Virtual 要件）
  - 表示モード実装時に再検討
- [ ] 12-13: サムネイル自動パラパラモード **保留**
  - スクラブモードとの排他制御が必要

---

## 🔮 将来構想 (Backlog)

> [!NOTE]
> 実装前に既存アーキテクチャへの影響を確認し、設計レビューを行うこと。

### 技術改善
- **ffmpeg Worker/Utility Process 化** — コイル鳴き完全解決（現状 `-threads 1` で軽減済み）
- **スキャンパフォーマンス改善** — バックグラウンドスキャン、プログレッシブスキャン

### 機能拡張
- テーマカスタマイズ（CSS 変数ベース、プリセットテーマ）
- スマートプレイリスト（条件ベース動的リスト）
- 自動整理（ルールベースのファイル移動・リネーム）
- AI 活用（自動タグ付け、類似画像検索）
- ファイル名一括リネーム
- エクスポート機能（HTML/CSV）
- プラグイン機構
- クラウド同期
- **設定のプロファイル紐づけ** — プロファイルごとに設定を保持する
- **プロファイル別ファイル形式指定** — プロファイルごとに動画のみ/漫画のみ といった対象形式を限定
- **FileCard「標準」アスペクト比の見直し** — 「標準」と「動画」の比率差が小さいため、再設計または名称変更
- **コンテキストメニューに「音声書庫として開く」オプション** — ネストが深い書庫でも音声プレーヤーとして開けるように

### プレビュー機能
- 動画プレビューの再生速度調整（0.5x〜2x）
- 画像比較モード（2 枚並べ表示）

### パフォーマンス改善
- **グループ表示モードの描画最適化**
  - 仮想スクロールの導入検討
  - グループの遅延レンダリング
  - メモ化の最適化

### タグ表示の追加改善
- **タグカテゴリの表示優先順位付け強化**
  - 現状: `sortOrder` で基本的な優先順位付けは実装済み
  - カテゴリ単位でのグループ化表示
  - 各カテゴリから均等に表示（バランス調整）
  - ドラッグ&ドロップでの sortOrder 編集

---

## 🔥 過去の緊急修正

> [!NOTE]
> 不具合修正は**一つずつ個別に取り組む**方針。修正→検証→コミットのサイクルを実施。

- [x] Lightbox 表示問題（画面はみ出し）— 2026-02-06
- [x] 書庫内音声の音量設定保存 — 2026-02-06
- [x] 書庫内複数フォルダ対応（既に実装済み）
- [x] 動画音量と音声音量の独立化 — 2026-02-17
