# Roadmap

MediaArchiver v2 の開発ロードマップです。

---

## ✅ 完了済み (Completed)

### Phase 0: 再構築準備
- [x] v1の問題点分析（点滅問題、設計の不透明さ）
- [x] 流用可能なロジック資産の特定
- [x] 再構築方針の決定

### Phase 1: プロジェクト基盤構築
- [x] ドキュメント整備 (ARCHITECTURE, CONVENTIONS, Glossary)
- [x] Vite + Electron + TypeScript プロジェクト初期化
- [x] Zustand ストア基本設計
- [x] SQLite データベーススキーマ設計
- [x] IPC通信基盤の構築

### Phase 2: コア機能実装
- [x] Phase 2-1: フォルダスキャン機能
- [x] Phase 2-2: ファイル操作系 (openExternal, showInExplorer)
- [x] Phase 2-3: UI連携 (Sidebar, FileGrid, FileCard, TanStack Virtual)
- [x] Phase 2-4: サムネイル生成 (FFmpeg/Sharp)

### Phase 3: UI機能拡張
- [x] Phase 3-1: サイドバー開閉機構
- [x] Phase 3-2: フォルダ右クリックメニュー（削除、再スキャン）
- [x] Phase 3-3: ファイルソート機能
- [x] Phase 3-4: LightBox（クイックプレビュー）
- [x] Phase 3-5: ファイルコンテキストメニュー

### Phase 4: アーカイブ対応
- [x] 書庫ファイル処理（v1からarchiveHandler移植）
- [x] 書庫内プレビュー

### Phase 5: 機能拡張
- [x] Phase 5-1: タグ管理システム（CRUD、フィルターパネル、管理モーダル）
- [x] Phase 5-2: タグフィルタリング（AND/OR モード）
- [x] Phase 5-3: 検索機能（ファイル名部分一致、デバウンス）
- [x] Phase 5-4: 設定画面（サムネイルサイズ、音量、ホバー動作）

### Phase 6: プロファイル・高度な機能
- [x] プロファイル切り替え（DB分割方式）
- [x] サムネイルホバー動作（scrub/play 実装）

### Phase 7: ブラッシュアップ
- [x] 7-1: キーボードショートカット（矢印キー、Ctrl/Shift選択、Space、Delete）
- [x] 7-2: パフォーマンス最適化
  - スキャン進捗表示（ScanProgressBar、統計、キャンセル機能）
  - パフォーマンスモード設定（ホバーアニメーション制御）
  - 起動時自動スキャン設定
  - 書庫サムネイル改善（タイムアウト、エラー判定、フォールバック）
- [x] 7-3: アニメーション・マイクロインタラクション

### Phase 8: データ整合性の強化 🔧
- [x] 8-1: サムネイル・プレビューフレームの自動削除
- [x] 8-2: トランザクション処理の導入
- [x] 8-3: エラーログシステムの実装


### Phase 9: コア機能の拡張 🚀
- [x] 9-1: 音声ファイル対応
- [x] 9-2: ファイルハッシュ計算と重複検出 ✅
- [x] 9-3: 「すべてのファイル」ビュー
- [x] 9-4: メモ機能

### Phase 10: データベース基盤強化 🔧
- [x] 10-1: DBスキーママイグレーションシステム
  - migrations/index.ts 実装
  - 初期スキーマ定義とバージョン管理

### Phase 11: 統計・ログ機能 📊
- [x] 11-1: カテゴリ別統計表示（円グラフ・棒グラフ）
- [x] 11-2: 追加統計機能（評価分布、巨大ファイル、拡張子、解像度）
- [x] 11-3: アクティビティログ（タイムライン表示、フィルタリング）

### Phase 12: UI/UX改善と機能強化 ✨
- [x] 12-1: トースト通知システム
- [x] 12-1.5: 技術的負債の解消（Z-Index管理、コンポーネント更新）
- [x] 12-2: タグ表示の改善（Pop-over展開、視認性向上）
- [x] 12-2.5: 基盤の健全化（カスタムプロトコル、セキュリティ強化）
- [x] 12-3: ファイルカード表示のカスタマイズ（サイズ・レイアウト変更）
- [x] 12-4: フォルダビュー拡張（フォルダカード表示）
- [x] 12-5a: スクラブモード時のシークバー表示
- [x] 12-6: ストレージクリーンアップ（孤立サムネイル削除）
- [x] 12-7: 外部アプリ複数設定機能
- [x] 12-8: タグ管理機能の拡張（アイコン、説明、自動タグ割り当て）
- [x] 12-9: 起動時自動スキャン & サイドバータグリスト展開
- [x] 12-10: ファイルカードのグループ表示
- [x] 12-11: 設定アイコンの視認性向上
- [x] 12-14: スキャン進捗表示の改善（アニメーション、最小化）
- [x] 12-15: 音声書庫アイコン改善
- [x] 12-16: 設定UI改善（サムネイルタブ化）
- [x] 12-17: ファイル削除ダイアログの改善（ゴミ箱/完全削除）
- [x] 12-18: サムネイル再作成最適化

### Phase 13: FileCard 基礎設計 🏗️
- [x] 13-1: 画像ファイルの扱い (`isAnimated`, `mediaType`)
- [x] 13-2: 表示情報の整理 (Primary/Secondary)
- [x] 13-3: 情報レイアウト刷新 (下寄せ・縦積み)
- [x] 13-4: タグ表示ルール (視認性改善)
- [x] 13-5: 配色ルール設定 (デザイントークン)

### Phase 14: 表示モードシステムとレイアウト改善 🎨
- [x] 14-1: 基盤整備 (DISPLAY_MODE_CONFIGS, zustand拡張)
- [x] 14-2: FileCardレイアウト刷新 (3行レイアウト / Compactモード)
- [x] 14-3: UI連携 (Headerへのモード切替ボタン追加)
- [x] 14-4: タグ表示改善 (展開/折りたたみ機能)
- [x] 14-5: 表示調整 (フォント最適化、グリッド固定高さ)
- [x] 14-6: レスポンシブレイアウト (カード幅の自動調整、余白最小化)
- [x] 14-7: タグポップオーバー表示 (インライン展開からポップオーバー方式へ変更)
- [x] 14-8: タグポップオーバートリガー設定 (クリック/ホバー切り替え、500ms遅延)


---

## 🚧 進行中 (In Progress)

(なし)

---

## 🔥 緊急不具合修正 (Critical Bugs)
**優先度**: 最高 - 次期実装で最優先対応

> [!NOTE]
> **次回セッションの方針 (2026-02-05)**  
> 不具合修正は**一つずつ個別に取り組む**こととする。  
> 複数の不具合を同時に修正すると、リグレッションの原因特定が困難になるため、  
> 各不具合の修正→検証→コミットのサイクルを確実に実施する。

- [x] 🐛 Lightbox表示問題の修正
  - メディアが画面からはみ出す問題の解決
  - `object-fit: contain` + `max-width/max-height` の適切な適用
  - **優先度**: 最高
  - **影響範囲**: UI表示全般
  - **完了日**: 2026-02-06

- [x] 🐛 書庫内音声ファイル音量設定の保存
  - 設定ストアの音量設定を書庫内音声再生に反映
  - **優先度**: 高
  - **影響範囲**: 書庫内音声再生
  - **完了日**: 2026-02-06

> [!NOTE]
> **将来対応検討 (Future Enhancement)**  
> 動画音量と音声音量の独立化を検討。  
> 現状は共通の `videoVolume` を使用しているが、ユースケースに応じて  
> 動画とBGM的な書庫内音声で異なる音量設定が望ましい可能性がある。  
> ユーザーフィードバックを得てから対応を判断する。

- [x] 🐛 書庫内複数フォルダ対応
  - 再帰的なファイル探索の実装
  - 複数階層の書庫ファイルに対応
  - **優先度**: 中
  - **影響範囲**: 書庫内複数階層構造
  - **状態**: 既に実装済み（7zaの`l`コマンドが再帰的に動作）
  - **影響範囲**: archiveHandler.ts

---

## 📋 予定 (Planned)

> [!NOTE]
> **Phase 8-11 は完了済みです**  
> 詳細は上部の「✅ 完了済み (Completed)」セクションを参照してください。  
> このセクションは参照用として残しています。

---

### Phase 14: 表示モード拡張（将来実装） 🎨
**目的**: 異なるコンテンツタイプに最適化された表示モードの追加  
**特性**: Phase 14 MVPの基盤を活用した拡張機能

- [ ] 14-7: 漫画モード
  - 2:3アスペクト比（縦長サムネイル）
  - 漫画・イラスト閲覧に最適化
  - カード幅160px、サムネイル高さ240px
  - **前提条件**: Phase 14 MVPの動作確認とユーザーフィードバック

- [ ] 14-8: 動画モード
  - 16:9アスペクト比（横長サムネイル）
  - 動画コンテンツに最適化
  - 再生時間の強調表示
  - カード幅280px、サムネイル高さ158px
  - **前提条件**: Phase 14 MVPの動作確認とユーザーフィードバック

- [ ] 14-9: WhiteBrowser風モード
  - 横長レイアウト（情報密度高）
  - サムネイル左、情報右の配置
  - 多数のメタデータ表示
  - **前提条件**: Phase 14 MVPの動作確認とユーザーフィードバック
  - **参考**: [file_card_表示設計に関する将来要望まとめ.md](file_card_表示設計に関する将来要望まとめ.md)

---

### Phase 12: UI/UX改善（残り）
- [ ] 12-12: サムネイルアスペクト比対応 ⏸️ **保留**
  - 縦長・横長・正方形サムネイルの最適表示
  - アスペクト比保持設定
  - **保留理由**: カード構造の大幅な変更が必要（カード幅の可変化など）
  - **将来対応**: 「表示モード」機能実装時に設計をすり合わせて再検討
  - **参考**: [file_card_表示設計に関する将来要望まとめ.md](file_card_表示設計に関する将来要望まとめ.md)
  - **リスク**: 中（仮想スクロールへの影響に注意）
  - **制約**: 固定高さを維持すること（TanStack Virtual要件）

- [ ] 12-13: サムネイル自動パラパラモード ⏸️ **保留**
  - ホバー時の自動シーク再生モード追加
  - スクラブモードとの切り替え設定
  - **保留理由**: FileCard挙動の大幅な変更が必要、Phase 12-12と同様の設計課題
  - **将来対応**: 「表示モード」機能実装時に設計をすり合わせて再検討
  - **参考**: [file_card_表示設計に関する将来要望まとめ.md](file_card_表示設計に関する将来要望まとめ.md)
  - **リスク**: 高（ホバー時の状態更新に注意）
  - **制約**: hover時の再描画を最小限に抑えること
  - **制約**: スクラブモードとの排他制御が必要

---

## 🔮 将来構想 (Backlog)

> [!WARNING]
> **Phase 13以降の機能は現行アーキテクチャの大幅な変更を伴います**  
> これらの機能は現在のフェーズ（Phase 1-12）とは要求レベルが大きく異なります。  
> 実装前に以下を確認してください:
> - 現行アーキテクチャの前提を破らないこと
> - 既存機能への影響を最小限に抑えること
> - 必要に応じてアーキテクチャの再設計を検討すること


---



**実装予定機能**:

- **ffmpeg Worker/Utility Process 化**
  - 目的: プレビューフレーム生成時のコイル鳴きを完全解決
  - ffmpeg プロセスを Worker または Utility Process として常駐化
  - 連続デコードにより瞬間負荷スパイクを回避
  - 現状: `-threads 1` で軽減済み、一部の重い動画では依然として発生
  - 詳細: `CONVENTIONS.md` の「既知の技術的制約と対策」を参照

- **スキャンパフォーマンスの改善**
  - バックグラウンドスキャンの実装
  - プログレッシブスキャン（大量ファイル対応）
  - キャッシュ最適化

---

**機能拡張:**

- **テーマカスタマイズ機能**
  - CSS変数ベースのカラーパレット管理
  - アクセントカラー選択（シークバー、ボタンなど）
  - プリセットテーマ（ダーク/ライト/シアン/アンバー/グリーンなど）
  - 設定画面でのカラーピッカー
- スマートプレイリスト（条件に基づく動的リスト）
- 自動整理（ルールベースのファイル移動・リネーム）
- プラグイン機構
- クラウド同期
- AI活用（自動タグ付け、類似画像検索）
- ファイル名一括リネーム
- エクスポート機能（HTML/CSV）

**プレビュー機能のアイデア（Phase 12-5b/5c）:**
- 動画プレビューの再生速度調整（0.5x, 1x, 1.5x, 2x）
- 画像比較モード（2枚並べて表示、左右独立ズーム）
