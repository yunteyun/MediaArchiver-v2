# ROADMAP

このファイルは「今後の計画」と「進行中の計画」を最優先で確認するための運用用ロードマップです。
詳細な過去履歴は `CHANGELOG.md` と `ROADMAP_legacy.md` を参照してください。

---

## 1. 進行中の計画 (In Progress)

- このセクションは「未完了 / 継続中」のみ記載（完了済みの詳細は `CHANGELOG.md`、要約は「最近完了した主な項目」へ）
- 実装開始時に追加、完了時に `CHANGELOG.md` と本ファイルの完了欄へ反映

- 表示モード改善（進行中）: FileCard表示モード定義/情報欄を分離し、`標準(S/M/L)` / `動画（ワイド）` / `漫画` の調整基盤を整備。漫画モードは `2:3 + width=210` を暫定採用し、情報欄テンプレート最終調整を継続
- エクスポート/インポート（HTML/CSV）（進行中）: 設定画面のバックアップタブに一覧エクスポートを集約し、`プロファイル全体` / `現在選択フォルダ全体` を選んで CSV / HTML 出力できる MVP を追加（インポート対応は `CSV` のみ。HTML は閲覧用）。保存ダイアログ経由で書き出し、CSV は UTF-8 BOM 付き、HTML は簡易テーブル形式（タグ色も含める）。あわせて「このアプリ形式CSV」のインポートMVP（タグ復元・追記型、Dry Run付き）と、旧アプリCSV（Shift_JIS/可変列）の互換インポート解析/適用（タグ + 星評価取込、Dry Run付き）を追加。次は出力項目の選択UI、選択ファイル限定出力、旧CSV互換ルールの調整を検討
- FileCard再設計メモ（検討）: 今後の機能追加を見据え、`FileCard.tsx` の挙動ロジックは維持しつつ、まず `FileCardInfoDetailed` を起点に見た目/責務を段階再設計する案を整理（タイトル行・メタ行・チップ行の再定義、サイズ/タグ/+N チップの共通化、標準M/Lを先に完成→漫画/動画へ展開）

---

## 2. 今後の計画 (Planned)

優先度の高い順に記載します。

### 直近（優先）
- 必要ならビルド識別ログ（build marker）追加

### サムネイル保存管理（工程）
- Phase A: 現状仕様の棚卸し（生成 / 保存 / DB保持 / クリーンアップ / 統計 / 移行）
- Phase B: 保存構造の決定（プロファイル単位・種別単位・パス表現）
- Phase C: パス解決の共通化（thumbnail path resolver 追加）
- Phase D: 生成系の切替（`thumbnail.ts` / `archiveHandler.ts` / preview frames）
- Phase E: 消費系の切替（cleanup / statistics / delete / storage migration）
- Phase F: 互換・再生成方針の確認（今回はデータ損失許容を活かして簡略化可）
- Phase G: 検証（初回スキャン / 再スキャン / プロファイル切替 / 保存場所切替 / cleanup）

進捗対応（Stepとの対応）:
- Step 1 = Phase C（完了）
- Step 2 = Phase D（完了、書庫系追加調整含む）
- Step 3 = Phase E（完了扱い、新構造確認は概ね正常・旧構造実地確認は保留）
- Step 4 = Phase E + 移行ロジック確認（完了扱い、相対パス化は別タスク候補）
- Step 5 = Phase F-G（完了、以後は回帰監視）

### 次点
- リリース運用の改善（更新手順の簡素化・説明整備）
- ログ/エラー表示の分かりやすさ改善（非エンジニア向け）
- 回帰確認チェックリストの整備

### 将来実装候補（コスト / リスク簡易評価）

評価基準:
- コスト: `低 / 中 / 高 / 特大`
- リスク: `低 / 中 / 高 / 特大`（既存アーキテクチャ影響 / 性能影響 / UI複雑化 / データ破壊リスクを含む）

#### 優先度高（費用対効果が高い）

着手候補（ドキュメント整理 / devlog 記録完了後、予定順）:

| 機能 | 概要 | コスト | リスク | 備考 |
|------|------|--------|--------|------|
| 表示モード拡張（漫画/動画/WhiteBrowser風） | コンテンツ別に最適化された表示モード | 中〜高 | 低〜中 | **一部実装済み（未調整）**。当面は優先度を落として保留でよい |
| FileCard「標準」アスペクト比の見直し | 標準/動画モード差分の再設計 or 名称見直し | 低〜中 | 低 | UI調整中心で着手しやすい |
| タグカテゴリ表示優先順位強化 | カテゴリごとの表示バランス改善 | 中 | 低〜中 | 既存タグ基盤を活用可能 |
| エクスポート（HTML/CSV） | メタデータ/一覧の出力 | 中 | 低〜中 | 読み取り中心で比較的安全 |

#### 優先度中（価値は高いが設計確認が必要）

| 機能 | 概要 | コスト | リスク | 備考 |
|------|------|--------|--------|------|
| 設定のプロファイル紐づけ | プロファイルごとに設定保持 | 中〜高 | 高 | 設定ストア/移行の整理が必要 |
| プロファイル別ファイル形式指定 | 動画のみ/漫画のみ等の対象形式制限 | 中 | 中 | スキャン/表示条件の整理が必要 |
| コンテキストメニュー「音声書庫として開く」 | 書庫を音声プレーヤーとして開く | 中 | 中 | 書庫処理分岐の追加が必要 |
| 12-13 サムネイル自動パラパラモード | 自動アニメ表示 | 中〜高 | 中〜高 | スクラブ/再生との排他制御が難所 |

#### 要設計レビュー（大型）

| 機能 | 概要 | コスト | リスク | 備考 |
|------|------|--------|--------|------|
| ffmpeg Worker / Utility Process 化 | コイル鳴き対策の根本解決 | 高 | 高 | ジョブ管理/IPC設計が必要 |
| スキャン性能改善 | バックグラウンド/プログレッシブスキャン | 高 | 高 | UI/DB/進捗整合が難しい |
| グループ表示モード描画最適化 | 仮想スクロール/遅延描画/メモ化最適化 | 高 | 高 | 表示崩れ・選択状態との整合に注意 |
| 自動整理（ルールベース移動・リネーム） | ルールで整理処理を実行 | 高 | 高 | 誤動作時の破壊リスク大 |
| AI活用（自動タグ/類似画像） | AIによる補助機能 | 高〜特大 | 高〜特大 | 推論基盤/コスト/UX設計が重い |
| プラグイン機構 / クラウド同期 | 拡張API / 同期機能 | 特大 | 特大 | セキュリティ/整合性/保守コストが大きい |

---

## 3. 直近リリース対象（Short-term Release Scope）

次回リリースに含める候補を管理します。

- [x] 書庫サムネイル初回スキャン不具合の修正確認（`1.1.3d5` 反映後の再検証）
- [x] ドキュメント整理（README / ROADMAP / メモ類）
- [x] 必要な changelog 追記と devlog 記録

---

## 4. 保留・バックログ (Backlog)

- UI/UX 改善案（詳細は `docs/dev/思考メモ.md`）
- 未解決不具合・要望（詳細は `docs/dev/不具合・要望リスト.md`）
- 中長期の配布改善（インストーラー化 / 自動更新の検討）

---

## 5. 最近完了した主な項目（要約）

- サムネイル保存管理の再設計（Step 1〜5）: 新保存構造への切替、cleanup/移行系の整合、旧構造フォールバック、書庫プレビュー固定キャッシュ、フォルダカード `404` 回避まで一連の対応を完了（詳細は `CHANGELOG.md`）
- 書庫プレビュー/Lightbox UI調整: 取得数・操作導線・情報パネルの見直しで、書庫プレビュー操作時の識別性と扱いやすさを改善
- 表示モード基盤整理と FileCard 情報欄分離: モード定義レジストリ化、情報欄テンプレート分離、表示モードメニュー整理、漫画モード暫定調整、レイアウト崩れ/アスペクト比不整合の修正を実施
- タグ表示改善: 右サイドバー / Lightbox のタグバッジにカテゴリ色を反映
- タグ表示順/管理UI改善: FileCard 要約タグにカテゴリ表示順ベースの並びと長タグ省略を反映し、設定で `カテゴリ分散 / 厳密順` を切替可能にした。タグ管理モーダルの表示優先順見える化・タグD&D並び替え・アイコン入力補助を追加し、左サイドバー/右サイドバー/Lightbox のタグ表示順も表示優先順ベースへ統一

- 配布/保存先運用の整理: dev/release の保存先・プロファイル分離、ログ保存先の整理（保存モード追従）、`update.bat` 同梱による ZIP 更新フロー追加
- ドキュメント整理（前段）: README / `docs/INDEX.md` の再構成、Markdown の UTF-8 統一（node_modules/release除外）、メモ類の `docs/user` / `docs/dev` への整理、`AGENTS.md` の追加
- ドキュメント整理（役割明確化の追記）: `ROADMAP.md` を未完了中心、`CHANGELOG.md` を完了済み変更の詳細とする運用に揃え、README / `docs/INDEX.md` / ROADMAP の記述を整合化
- 開発メモ整備: `docs/dev/思考メモ.md` に最小Git運用ルール、作業コード番号/命名規約、プレビューフレーム比較メモを追記
- UI安定化修正: タグ管理モーダルの Portal 化と Hook 順序不整合修正で表示消失/背景残り問題を解消
- 書庫サムネイル生成まわりの安定化: `7za` 解決失敗（開発版）と書庫サムネイル生成失敗（`EXDEV` / `ENOENT` / 初回スキャン失敗）を修正
- 互換・移行期の表示安定化: 統計の旧保存構造フォールバック追加と `media://` パス解釈の安定化対応

詳細は `CHANGELOG.md` を参照。

---

## 6. ドキュメントの使い分け

- `ROADMAP.md`: 今後の計画 / 進行中 / 直近リリース対象
- `CHANGELOG.md`: リリース単位の変更履歴
- `docs/INDEX.md`: ドキュメント地図（何をどこに書くか）
- `docs/user/アプリ使用メモ.md`: ユーザー向け操作・更新手順
- `docs/dev/不具合・要望リスト.md`: 未解決の不具合・要望
- `docs/dev/思考メモ.md`: 検討中アイデア（未確定）
- `.agent/devlog/YYYY-MM-DD.md`: 日次作業記録
- `ROADMAP_legacy.md`: 過去の詳細フェーズ表（退避）

---

## 7. 運用ルール（簡易）

1. 実装完了後に `CHANGELOG.md` と `ROADMAP.md` を更新する
2. 不具合は `docs/dev/不具合・要望リスト.md`、検討中は `docs/dev/思考メモ.md` に分ける
3. セッション終わりに `.agent/devlog/YYYY-MM-DD.md` を記録する
