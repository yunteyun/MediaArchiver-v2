# Roadmap

MediaArchiver v2 の開発ロードマップです。

---

## ✅ 完了済み (Completed)

### Phase 0: 再構築準備
- [x] v1の問題点分析（点滅問題、設計の不透明さ）
- [x] 流用可能なロジック資産の特定
- [x] 再構築方針の決定

### Phase 1: プロジェクト基盤構築
- [x] ドキュメント整備 (ARCHITECTURE, CONVENTIONS, Glossary)
- [x] Vite + Electron + TypeScript プロジェクト初期化
- [x] Zustand ストア基本設計
- [x] SQLite データベーススキーマ設計
- [x] IPC通信基盤の構築

### Phase 2: コア機能実装
- [x] Phase 2-1: フォルダスキャン機能
- [x] Phase 2-2: ファイル操作系 (openExternal, showInExplorer)
- [x] Phase 2-3: UI連携 (Sidebar, FileGrid, FileCard, TanStack Virtual)
- [x] Phase 2-4: サムネイル生成 (FFmpeg/Sharp)

### Phase 3: UI機能拡張
- [x] Phase 3-1: サイドバー開閉機構
- [x] Phase 3-2: フォルダ右クリックメニュー（削除、再スキャン）
- [x] Phase 3-3: ファイルソート機能
- [x] Phase 3-4: LightBox（クイックプレビュー）
- [x] Phase 3-5: ファイルコンテキストメニュー

### Phase 4: アーカイブ対応
- [x] 書庫ファイル処理（v1からarchiveHandler移植）
- [x] 書庫内プレビュー

### Phase 5: 機能拡張
- [x] Phase 5-1: タグ管理システム（CRUD、フィルターパネル、管理モーダル）
- [x] Phase 5-2: タグフィルタリング（AND/OR モード）
- [x] Phase 5-3: 検索機能（ファイル名部分一致、デバウンス）
- [x] Phase 5-4: 設定画面（サムネイルサイズ、音量、ホバー動作）

### Phase 6: プロファイル・高度な機能
- [x] プロファイル切り替え（DB分割方式）
- [x] サムネイルホバー動作（scrub/play 実装）

### Phase 7: ブラッシュアップ
- [x] 7-1: キーボードショートカット（矢印キー、Ctrl/Shift選択、Space、Delete）
- [x] 7-2: パフォーマンス最適化
  - スキャン進捗表示（ScanProgressBar、統計、キャンセル機能）
  - パフォーマンスモード設定（ホバーアニメーション制御）
  - 起動時自動スキャン設定
  - 書庫サムネイル改善（タイムアウト、エラー判定、フォールバック）
- [x] 7-3: アニメーション・マイクロインタラクション

### Phase 8: データ整合性の強化 🔧
- [x] 8-1: サムネイル・プレビューフレームの自動削除
- [x] 8-2: トランザクション処理の導入
- [x] 8-3: エラーログシステムの実装

### Phase 9: コア機能の拡張 🚀
- [x] 9-1: 音声ファイル対応
- [x] 9-2: ファイルハッシュ計算と重複検出 ✅
- [x] 9-3: 「すべてのファイル」ビュー
- [x] 9-4: メモ機能

---

## 🚧 進行中 (In Progress)

(なし)

---

## 📋 予定 (Planned)

### Phase 8: データ整合性の強化 🔧
**目的**: 長期使用時の安定性とデータ信頼性の確保

- [x] 8-1: サムネイル・プレビューフレームの自動削除
  - ファイル削除時にサムネイル画像も削除
  - フォルダ削除時に配下の全サムネイルを削除
  - プロファイル削除時にサムネイルディレクトリごと削除
  - **効果**: ストレージ肥大化の防止

- [x] 8-2: トランザクション処理の導入
  - スキャン処理をバッチトランザクション化（100件ごと）
  - データベース書き込みの高速化（10〜100倍）
  - クラッシュ時の自動ロールバック
  - **効果**: スキャン速度向上とデータ整合性の確保

- [x] 8-3: エラーログシステムの実装
  - `electron-log` ライブラリの導入
  - ログファイルへの永続化（`logs/app-YYYY-MM-DD.log`）
  - エラーレベル別のログ出力（error/warn/info/debug）
  - 設定画面にログビューアー追加 ✅
  - **効果**: デバッグ効率の向上、ユーザーサポートの改善

---

### Phase 9: コア機能の拡張 🚀
**目的**: アプリケーションの実用性向上

- [x] 9-1: 音声ファイル対応
  - 対応形式: mp3, wav, flac, m4a, ogg, aac, wma ✅
  - アルバムアート抽出（FFmpeg） ✅
  - メタデータ取得（アーティスト、アルバム、再生時間） ✅
  - 書庫内音声ファイルの対応 ✅
  - 書庫内音声再生UIの改善（表示サイズ調整） ✅
  - 書庫内音声の連続再生オプション ✅
  - [ ] 再生中トラックの視認性改善（アイコン、アニメーション等）
  - **効果**: 管理対象ファイルの拡大

- [x] 9-2: ファイルハッシュ計算と重複検出 ✅
  - ファイルハッシュ（SHA256）の計算・保存
  - サイズ衝突戦略による高速重複検出
  - 重複ファイル一覧表示UI
  - スマート選択（新しい/古い/パスが短いファイルを残す）
  - 重複ファイルの一括削除機能
  - **効果**: ストレージ効率化、重複管理

- [x] 9-3: 「すべてのファイル」ビュー
  - 全フォルダ統合表示機能 ✅
  - ~~複数フォルダの同時選択フィルター~~（将来実装）
  - ~~ドライブ別グループ表示（サイドバー階層化）~~（将来実装）
  - **効果**: 大量ファイルの横断検索

- [x] 9-4: メモ機能
  - ファイルごとのメモ追加・編集 ✅
  - ~~メモ内容の検索対応~~（将来実装）
  - LightBox にメモ編集UI追加 ✅（自動保存機能付き）
  - **効果**: ファイル整理の効率化

---

### Phase 10: データベース・システム強化 🛡️
**目的**: 長期運用の安定性確保

- [x] 10-1: DBスキーママイグレーション ✅
  - マイグレーションシステムの実装
  - 既存DBとの互換性対応
  - **効果**: 将来的なスキーマ変更への対応

- [ ] 10-2: バックアップ・リストア機能
  - データベースの手動バックアップ
  - 自動バックアップ設定（日次/週次）
  - バックアップからのリストア
  - バックアップログ記録
  - **効果**: データ損失リスクの低減

- [ ] 10-3: パフォーマンス最適化（第2弾）
  - タグキャッシュの一括取得（SQL JOIN化）
  - サムネイル生成の並列処理（p-limit使用）
  - 大量ファイル時のメモリ使用量削減
  - **効果**: 大規模ライブラリでの快適な動作

- [ ] 10-4: ファイルパス検証とエラーハンドリング強化
  - パス長の検証（Windows 260文字制限対応）
  - 無効文字のチェック
  - アクセス権限エラーの適切な処理
  - **効果**: クラッシュリスクの低減

---

### Phase 11: 統計・分析機能 📊
**目的**: ライブラリの可視化と管理効率化

- [ ] 11-1: カテゴリ別統計表示
  - タグ別ファイル数
  - ファイルタイプ別統計
  - ストレージ使用量
  - フォルダ別統計

- [ ] 11-2: ダッシュボード
  - 各種情報の集約表示
  - 最近追加されたファイル
  - よく使うタグ
  - クイックアクション（よく使うフォルダへのショートカット）

- [ ] 11-3: アクティビティログ
  - ファイル追加・削除履歴
  - タグ付け履歴
  - スキャン履歴

---

### Phase 12: UI/UX改善 🎨
**目的**: ユーザー体験の向上（コア機能が安定してから実装）

- [ ] 12-1: トースト通知システム
  - エラー・成功メッセージの画面表示
  - 非侵入型の通知UI
  - 通知履歴の表示

- [ ] 12-2: タグ表示の改善
  - タグの省略表示とスライド展開
  - タグカテゴリ別の色分け強化
  - タグの優先順位表示

- [ ] 12-3: ファイルカード表示のカスタマイズ
  - カードサイズ・レイアウト可変設定
  - 表示内容のカスタマイズ（メタデータ表示項目選択）
  - コンパクトモード/詳細モード切り替え

- [ ] 12-4: フォルダビュー拡張
  - フォルダカード表示
  - フォルダサムネイル（代表画像）

- [ ] 12-5: プレビュー機能強化
  - スクラブモード時のシークバー表示
  - 動画プレビューの再生速度調整
  - 画像比較モード（2枚並べて表示）

---

## 🔮 将来構想 (Backlog)

### 高度な機能（Phase 13以降）
- スマートプレイリスト（条件に基づく動的リスト）
- 自動整理（ルールベースのファイル移動・リネーム）
- プラグイン機構
- クラウド同期
- AI活用（自動タグ付け、類似画像検索）
- ファイル名一括リネーム
- エクスポート機能（HTML/CSV）
