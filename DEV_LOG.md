# 開発日誌

## 2026-02-23

### 実施内容
- サムネイル保存管理のドキュメント整合性更新（`ROADMAP.md` / `CHANGELOG.md` / `.agent/implementation_plan.md`）
- `thumbnailCleanupService.ts` 改善
  - 旧保存構造 fallback 時に全プロファイルDB参照を集約（誤判定抑制）
  - `archive-preview` 固定キャッシュを孤立サムネイル判定対象から除外
- Lightbox（書庫プレビュー）UI/UX 調整
  - プレビュー取得数/キャッシュ生成数を `12 -> 6`
  - レイアウト調整（情報パネルとプレビューの視覚分離、プレビュー枠のサイズ調整）
  - `×` / `Esc` / 背景クリックを段階動作へ統一
  - プレビュー外クリックで前の画面に戻る動作を追加
- タグ表示改善
  - 右サイドバー/Lightbox タグバッジのカテゴリ色反映を修正
  - Lightbox 情報パネルに大きめのファイル名を追加
- 手動確認
  - サムネイル/プロファイル保存場所の移動と削除: 正常
  - 孤立サムネイル削除: `archive-preview` 誤判定修正後に正常
  - 新構造運用: 概ね正常（旧構造実地確認はデータ不在で未実施）
  - Step 5 検証で、フォルダカード代表サムネイル `404`（古い `thumbnail_path`）を再現 → 代表サムネイル取得時に実在ファイル優先へ修正し復旧確認
  - Step 5 最小回帰確認（再スキャン / 再生成 / プロファイル切替 / cleanup 後確認）を一通り実施し、致命的な回帰なし

### メモ
- Step 4 は実質完了（`storageConfig.ts` の移行/切替ロジック整合を確認、残りは相対パス化の優先度判断）
- Step 5 は実質完了（回帰監視へ移行）

---

## 2026-02-06

## 実施内容
- **Phase 12-4 (フォルダビュー拡張):** ✅ 完了
  - フォルダカード表示、ナビゲーション機能実装
  - 初期実装で表示されないバグがあったが修正済み
- **Phase 12-5a (スクラブモードシークバー):** ❌ 実装失敗・中断
  - シークバーUIの実装を試みたが、ユーザー体験を満たせずリバート

## 反省点・課題 (AIとの意思疎通・実装プロセス)

本日のPhase 12-5aの実装において、以下の問題が発生したため、実装を巻き戻して終了しました。

### 1. 仕様認識の齟齬 (Communication Gap)
- **問題:** 「シークバー」という用語に対し、AIは「プログレスバー（左から塗りつぶし）」を実装したが、ユーザーは「インジケーター（マウスに追従するマーカー）」を期待していた可能性があった。
- **結果:** AI側で「プログレスバー型である」と確認したつもりだったが、最終的なユーザーの感想は「以前と差を感じられない」「動作していないように見える」であった。
- **教訓:** UIの挙動変更、特にインタラクティブな要素については、言葉だけの確認ではなく、ASCIIアートや具体的な挙動例（「マウスカーソルに追従する縦線」など）を用いて、より具体的かつ視覚的なイメージのすり合わせを行う必要がある。

### 2. 動作確認基準のズレ (Verification Gap)
- **問題:** AIはデバッグログ（数値）が正しいことをもって「修正完了」と判断したが、ユーザーの**視覚的・体感的なフィードバック**（「画面上で動いているように見えるか」）と乖離していた。
- **結果:** 「ログでは動いています」というAIの報告と、「見た目は変わっていない」というユーザーの観測が食い違った。
- **教訓:** 数値的な正しさだけでなく、「ユーザーの目にどう映るか」を常に意識する。特に「動き」のあるUI実装時は、数値の変化だけでなく、CSSの適用状況や視認性（色、太さ、重なり順）も含めた確認が必要。

### 3. "Fix"のアプローチ (Implementation Gap)
- **問題:** 動作しない原因を「座標計算（マウスイベントのターゲット）」と即断し、計算ロジックを修正したが、そもそもUIが表示されていない、あるいは視認できない可能性などを十分に検証しきれなかった。
- **結果:** 技術的には正しい修正（座標計算の適正化）を行ったが、ユーザー体験の向上には繋がらなかった。

## 次回への申し送り
Phase 12-5aの実装を再開する際は、以下のステップを踏むこと：
1. **仕様の再定義:** 「シークバー」の挙動（プログレスバー vs インジケーター）を完全に明確化する。
2. **可视性の確保:** 最初は極端に目立つ色やサイズで実装し、確実に「表示されていること」「動いていること」を確認してからデザインを調整する。
3. **段階的実装:** 一気に完成形を目指すのではなく、「まずは表示」「次は動き」と段階を踏んでユーザー確認を得る。
