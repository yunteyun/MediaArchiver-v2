# 思考メモ

## このファイルの役割
- 検討中のアイデア・比較案・未確定の方針を書く
- 実装確定後は `ROADMAP.md` / `CHANGELOG.md` / 各仕様書へ移す（このファイルは `docs/dev/` 配下）

## 書き方ルール（簡易）
- 結論未確定の内容を置く
- 決まったら「採用 / 見送り」を追記する

---
## Lightbox V2 再設計メモ（2026-02-26）

### 背景（今回の判断理由）
- 背景/情報エリア/メディア領域の視認性調整を局所修正で繰り返すと、変更点が見えにくく副作用の切り分けが難しい
- 背景クリックで閉じる範囲とメディア表示サイズ・ラッパー構造が干渉しやすく、画像/動画/書庫で挙動が揃いにくい
- `LightBox` / `MediaViewer` にレイアウト・操作・書庫固有ロジックが混在し、設計上の責務境界が曖昧

### 採用（今回の方針）
- `Lightbox V2` を段階移行で実装する（既存 `LightBox` を一気に置き換えない）
- まず `画像モード` を先行実装し、背景/クリック領域/閉じる導線の操作モデルを固定する
- `動画モード` は画像モードの操作モデルを流用し、動画固有（シーク/音量キー）だけを上乗せする
- `書庫モード` は最後に移行し、段階的な戻る挙動（単体画像 -> 書庫一覧 -> Lightbox閉じる）を V2 モデルへ合わせる

### 画像モード V2 で先に固定したい仕様（MVP）
- `×` ボタンはメディア枠の外側右上に配置（画像に重ねない）
- メディア外側（メディアフレーム外）のクリックで `閉じる`
- メディア本体クリックは閉じない（誤操作防止）
- 背景は「Lightbox主要表示領域全体」に一括で敷き、情報エリア/メディアエリアは区切り線主体で分離
- 画像の最大表示サイズは情報エリア高さとのバランスを優先（`max-h` 基準）

### 責務分割案（V2）
- `LightboxShellV2`: 全画面オーバーレイ、`Esc`、左右移動、フォーカス管理
- `LightboxLayoutV2`: 一括背景シェル、左情報エリア、右メディアエリアのレイアウト
- `LightboxMediaFrameV2`: メディア枠、`×` ボタン位置、メディア外クリック領域
- `LightboxInfoPaneV2`: 情報表示（タグ/メモ/統計）のみ
- `ImageViewerV2 / VideoViewerV2 / AudioViewerV2 / ArchiveViewerV2`: 種別ごとの表示
- `useLightboxControllerV2`（必要なら）: 段階的close/back、選択状態、ショートカット状態

### 段階実行プラン（案）
#### Step 1: 画像モード仕様の固定（低リスク）
- 操作仕様（閉じる/戻る/クリック範囲/サイズ上限）をメモで固定
- 既存 `LightBox` の見た目微調整は最小限に留める

#### Step 2: `LightBoxV2` 骨組み作成（中リスク）
- `LightboxShellV2` / `LightboxLayoutV2` / `LightboxMediaFrameV2` を追加
- 画像ファイルのみ V2 にルーティング（他種別は既存継続）

#### Step 3: 情報エリア整理（中リスク）
- `InfoPanel` 相当を V2 用に整理（余白/区切り/可読性）
- 一括背景 + 内側パネルの責務を明確化

#### Step 4: 動画モード移行（中〜高リスク）
- 画像モードの操作モデルを踏襲しつつ、動画キー操作・音量同期を移植

#### Step 5: 書庫モード移行（高リスク）
- 画像/音声混在・単体画像表示・段階戻り動作を V2 に移植
- 既存 `MediaViewer` の書庫ロジック分解を優先

### 受け入れ条件（画像モード V2 完了判定）
- `×` ボタン位置が画像上に被らず、見失いにくい
- 背景クリックで閉じる範囲が視覚上の「外側」と一致する
- 背景/情報エリア/メディア領域の見分けがつく（背景抜けの違和感がない）
- 既存の左右移動・`Esc`・クイックタグ操作が維持される

### 保留（後でやる）
- ライトボックス全種別の見た目統一を一度にやる（段階移行を優先）
- 情報エリアの内容再編（項目の増減）は V2 骨組み安定後に着手

---
## FileCard再設計メモ（2026-02-25）

### 目的
- `FileCardInfoDetailed` 起点で、見た目の統一と責務整理を段階的に進める
- 今回確定した表示仕様を先に固定し、次回以降の調整コストを下げる

### 採用（今回の確定仕様）
- `標準（M）` / `標準（L）` / `漫画` / `動画（ワイド）` は「同型レイアウト」を採用
- 2段目は `サイズ / 作成日 / フォルダ名` のバッジ列
- 下段はタグ要約行（右寄せ）
- `漫画` / `動画（ワイド）` は同型を維持しつつ密度のみ調整（タグ件数/幅、フォルダ名バッジ幅など）

### モード別の現状パラメータ（実装ベース）
- `標準（M）`: 情報欄高さ `80`
- `標準（L）`: 情報欄高さ `80`
- `漫画`: 情報欄高さ `76`、タグ要約 `2件`、フォルダ名バッジ幅を短め
- `動画（ワイド）`: 情報欄高さ `76`、2段目バッジ列化（ファイル名潰れ回避のため）
- タグ要約バッジ: `標準（M/L）` は文字量を増やした大きめ設定、`漫画` はやや控えめ

### 現在の責務分担（把握）
- `src/components/fileCard/FileCardInfoDetailed.tsx`
- 詳細情報欄の行構成（タイトル / 2段目 / タグ行）を担当
- モード別の表示分岐（M/L/漫画/動画）が集まりやすい

- `src/components/FileCard.tsx`
- `renderTagSummary()` を保持（タグ並び、`+N`、ポップオーバー制御）
- タグ要約の見た目調整が `FileCardInfoDetailed` から離れている

- `src/components/fileCard/displayModes.ts`
- モード別の寸法（`aspectRatio`, `infoAreaHeight` など）を管理
- 見た目の密度パラメータ（タグ件数、フォルダバッジ幅など）は未集約

### 次に整理したいポイント（再設計メモ）
- `renderTagSummary()` の見た目パラメータを `FileCard.tsx` から分離できないか検討
- モード別パラメータ（タグ件数、タグバッジ幅、フォルダ名バッジ幅）を設定表に寄せる
- `FileCardInfoDetailed` の条件分岐を「モード分類（同型/例外）」ベースに整理
- 2段目バッジ列の共通コンポーネント化（`MetaBadgeRow` 的な切り出し）を検討

### 段階的リファクタ手順（案）
#### Step 1: パラメータの見える化（低リスク）
- `displayModes.ts` または隣接ファイルに「詳細情報欄UIパラメータ」を集約
- 対象: `tagVisibleCount`, `tagChipMaxWidth`, `folderBadgeMaxWidth`, `useBadgeMetaRow`
- 目的: `FileCardInfoDetailed.tsx` の条件分岐を値参照中心に寄せる

#### Step 2: 2段目バッジ列の切り出し（低〜中リスク）
- `FileCardMetaBadgeRow`（仮）を新規作成
- `サイズ / 作成日 / フォルダ名` の表示責務を移す
- `FileCardInfoDetailed.tsx` 側では「表示するか / しないか」の判定だけ持つ

#### Step 3: タグ要約の見た目パラメータ分離（中リスク）
- `renderTagSummary()` のロジック（タグ選択/ポップオーバー制御）と見た目パラメータを分離
- 見た目は `tagSummaryStyleConfig` 的な設定値経由にする
- `FileCard.tsx` に残すもの: `triggerRef`, `popover state`, `open/close handler`

#### Step 4: 同型/例外の分岐整理（中リスク）
- 「同型レイアウト群（標準M/L・漫画・動画）」と「例外（compact）」で分岐を整理
- 条件式の散在を減らし、`if (layoutKind === 'badgeMetaDetailed')` の形へ寄せる

### 実施済み（2026-02-25）
- Step 1 実施: モード別UIパラメータを `getDetailedInfoUiConfig()` / `getTagSummaryUiConfig()` に集約し、条件分岐の見える化を進めた
- Step 2 実施: `FileCardInfoDetailed` の 2段目バッジ列と下段行を `DetailedBadgeMetaRow` / `DetailedBottomRow` に切り出した
- Step 3 実施: タグ要約の描画責務を `FileCardTagSummaryRow` に分離し、`renderTagSummary` の責務を軽くした
- Step 4 実施（前半〜中盤）: `FileCardTagSummary` を追加し、タグ選定/描画/`+N` 制御を `FileCard` 本体から分離
- Step 4 実施（受け渡し整理）: `FileCardInfoArea` 系の props を `renderTagSummary` callback から `TagSummaryRenderer` コンポーネント受け渡しへ変更

### 残作業メモ（次にやるなら）
- `FileCardTagSummary` / popover 本体の切り出し検討（`triggerRef` / `popoverRef` / click-outside の owner をどう持つか）
- `displayModes.ts` へ寄せる値の範囲を再定義（寸法のみ維持するか、密度設定まで含めるか）
- `layoutKind`（同型/例外）の明示的な型導入は、次の実装変更が出た時点で着手

### 切り出し候補（たたき台）
#### `FileCardMetaBadgeRow`（仮）
- 入力:
  - `file`
  - `showFileSize`
  - `folderBadgeMaxWidth`
  - `showCreatedDate`（必要なら）
- 役割:
  - 2段目バッジ列の描画
  - `truncate` とバッジ順の維持
- 役割外:
  - タグ要約
  - タグポップオーバー制御

#### `getDetailedInfoUiConfig(displayMode)`（仮）
- 返す値（候補）:
  - `useBadgeMetaRow`
  - `tagVisibleCount`
  - `folderBadgeMaxWidthClass`
  - `tagSummaryDensity`（`standard` / `compact` など）
- 目的:
  - `displayMode` 条件の分散を抑える

### 回帰確認の反映メモ（2026-02-25）
- 回帰確認で `動画（ワイド）` の表示だけ不揃い・ファイル名潰れを検出
- 対応済み:
  - 動画モードも同型レイアウト（2段目バッジ列）へ寄せた
  - 情報欄高さを `70 -> 76` に調整
- 学び:
  - 「同型化したモード群」をメモで先に定義しておくと、回帰時の判断が速い

### 実装時の注意（再発防止）
- `infoAreaHeight` を変更したら `totalHeight` も同時更新する
- タグバッジ幅を広げる時は `+N` ボタンの見え方もセットで確認する
- 漫画/動画は横幅が狭いため、件数増加より先に幅上限の調整を試す

### チェック観点（今回追加した回帰確認と連動）
- `docs/dev/回帰確認チェックリスト.md` を使用
- 回帰確認で出た差分は、このセクションに「採用 / 見送り」判断メモとして追記する

### 保留（今回やらない）
- 標準/漫画のタグ表示件数をユーザー設定化（まず固定値で運用）

---
# 思考メモ（AIの意見聞いてみたいアイディア）
- Lightboxでの動画画像の表示調整。現状サイズの大きいものは画面からはみ出して表示されてしまったり、ファイル名などの表示に被ってしまっている。
## 機能アイデア

### バックアップログ機能 ✅
- バックアップの際、どこを・何を・完了したタイミングで保存したかをメモする
- 実装予定: Phase 4（設定画面と一緒に）
- 保存形式: `userData/backup-log.json`

### デバッグログ表示 ✅
- 常にデバッグログを表示しておいた方が良いかもしれない
- 実装方針:
  - 開発モード: 常時表示
  - 本番モード: 設定でON/OFF切替可能
  - ログはファイルにも保存（`logs/app-YYYY-MM-DD.log`）

### モデル切り替え対策 ✅ (2026-01-31 実装済み)
- `.agent/SESSION.md`: セッション間の文脈継続
- `CHANGELOG.md`: 変更履歴管理
- `.agent/decisions/`: ADR（設計判断記録）
- `.agent/workflows/refresh.md`: コンテキストリフレッシュワークフロー

---

## UIデザインアイディア (2026-01-31)

参考: Dribbble "Space Box File Manager" / "File Manager Overview"

### 取り込みたい要素

#### 1. サイドバー開閉機構 ⭐
- アイコン+テキスト ↔ アイコンのみ の切り替え
- width transitionでスムーズに開閉
- （AI意見: 実装難易度中、効果高。Tailwindで比較的簡単に実装可能。優先度高め）

#### 2. カテゴリ別カラーカード
- Documents/Images/Videos/Audios を色分けカードで表示
- 現在の「video/image/archive」分類と親和性あり
- （AI意見: ダッシュボード的な見せ方。フォルダ単位の統計表示と相性良い）

#### 3. フォルダカード表示
- リスト形式→カード形式への切り替えオプション
- ファイル数・サイズを視覚的に表示
- （AI意見: サイドバーのフォルダ表示を拡張する形で取り込めそう）

#### 4. アクティビティログ
- 操作履歴（追加/削除/開いた記録）の表示
- 「バックアップログ機能」と組み合わせ可能
- （AI意見: Phase 4の設定画面と一緒に実装するのが良さそう）

### 慎重に検討が必要
- **右サイドパネル**: 画面が狭くなる。メディア表示特化なら不要かも
- **リスト表示モード**: サムネイルグリッドが主用途なら優先度低


## Git運用ルール（最小）
- 通常作業は `codex/...` の既存ブランチで継続する（ブランチを増やしすぎない）
- ブランチを新しく切るのは「大規模変更」の時だけ（DB構造変更 / データ移行 / UI全面改修 / リリース影響大）
- コミットは小さく区切る（動いた単位でコミット）
- 作業コード番号を付ける場合は `C001`, `C002` のように連番で管理する（Codex作業）
- ブランチ名は `codex/c###-short-name`、コミットは `codex(c###): ...` の形式を推奨
- 実装完了時は `CHANGELOG.md` と `ROADMAP.md` を更新する
- セッション終了時は `.agent/devlog/YYYY-MM-DD.md` を記入する
